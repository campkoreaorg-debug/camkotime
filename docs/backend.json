{
  "entities": {
    "Venue": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Venue",
      "type": "object",
      "description": "Represents a physical venue or location.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Venue entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the venue."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the venue."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the venue."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the venue."
        },
        "address": {
          "type": "string",
          "description": "Street address of the venue."
        }
      },
      "required": [
        "id",
        "name",
        "latitude",
        "longitude"
      ]
    },
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents a staff member associated with a venue.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Staff entity."
        },
        "name": {
          "type": "string",
          "description": "Full name of the staff member."
        },
        "role": {
          "type": "string",
          "description": "Job title or role of the staff member."
        },
        "venueId": {
          "type": "string",
          "description": "Reference to Venue. (Relationship: Venue 1:N Staff)"
        }
      },
      "required": [
        "id",
        "name",
        "role",
        "venueId"
      ]
    },
    "Schedule": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Schedule",
      "type": "object",
      "description": "Represents a scheduled event or activity at a venue.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Schedule entity."
        },
        "venueId": {
          "type": "string",
          "description": "Reference to Venue. (Relationship: Venue 1:N Schedule)"
        },
        "startTime": {
          "type": "string",
          "description": "Start time of the scheduled event.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "End time of the scheduled event.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the scheduled event."
        }
      },
      "required": [
        "id",
        "venueId",
        "startTime",
        "endTime"
      ]
    },
    "ExternalDevice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExternalDevice",
      "type": "object",
      "description": "Represents an external device integrated with the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExternalDevice entity."
        },
        "deviceId": {
          "type": "string",
          "description": "Identifier from the external device."
        },
        "deviceType": {
          "type": "string",
          "description": "Type of the external device (e.g., sensor, actuator)."
        },
        "venueId": {
          "type": "string",
          "description": "Reference to Venue. (Relationship: Venue 1:N ExternalDevice)"
        },
        "status": {
          "type": "string",
          "description": "Current status of the external device (e.g., active, inactive)."
        }
      },
      "required": [
        "id",
        "deviceId",
        "deviceType",
        "venueId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/venues/{venueId}",
        "definition": {
          "entityName": "Venue",
          "schema": {
            "$ref": "#/backend/entities/Venue"
          },
          "description": "Stores venue information. The venueId is used as the document ID.",
          "params": [
            {
              "name": "venueId",
              "description": "Unique identifier for the venue."
            }
          ]
        }
      },
      {
        "path": "/venues/{venueId}/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff information associated with a specific venue. The staffId is used as the document ID.",
          "params": [
            {
              "name": "venueId",
              "description": "Unique identifier for the venue."
            },
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            }
          ]
        }
      },
      {
        "path": "/venues/{venueId}/schedules/{scheduleId}",
        "definition": {
          "entityName": "Schedule",
          "schema": {
            "$ref": "#/backend/entities/Schedule"
          },
          "description": "Stores schedule information for a specific venue. The scheduleId is used as the document ID.",
          "params": [
            {
              "name": "venueId",
              "description": "Unique identifier for the venue."
            },
            {
              "name": "scheduleId",
              "description": "Unique identifier for the schedule entry."
            }
          ]
        }
      },
      {
        "path": "/venues/{venueId}/externalDevices/{deviceId}",
        "definition": {
          "entityName": "ExternalDevice",
          "schema": {
            "$ref": "#/backend/entities/ExternalDevice"
          },
          "description": "Stores external device information associated with a specific venue. The deviceId is used as the document ID.",
          "params": [
            {
              "name": "venueId",
              "description": "Unique identifier for the venue."
            },
            {
              "name": "deviceId",
              "description": "Unique identifier for the external device."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support VenueSync's real-time updates and role-based access (admin/viewer) while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling.  The structure uses path-based ownership and denormalization to avoid `get()` calls in security rules, enhancing security and scalability. \n\n*   **Venues Collection:** Top-level collection to store venue details.  All other data related to a venue (staff, schedules, devices) are stored in subcollections under each venue. This enforces a clear hierarchy and ownership.\n*   **Staff, Schedules, ExternalDevices Subcollections:** Each venue has its own subcollections for staff, schedules, and external devices.  This segregation allows for specific security rules at each level and supports the 1:N relationships.\n\n**Authorization Independence (Denormalization):** No `get()` calls are required in the security rules. The data structure is designed for Authorization Independence because it utilizes path-based ownership.\n\n**QAPs (Rules are not Filters):**\n*   Secure `list` operations are supported by the structural segregation. For instance, listing schedules is always scoped to a specific venue.  There's no need to filter based on authorization within the rules themselves.\n\nThis design facilitates simple and robust security rules and supports the application's core features of real-time updates and role-based access."
  }
}